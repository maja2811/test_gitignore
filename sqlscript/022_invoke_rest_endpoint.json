{
	"name": "022_invoke_rest_endpoint",
	"properties": {
		"content": {
			"query": "--======================================================================================================\n-- Get response from powerbi restapi\n--======================================================================================================\ndeclare @url nvarchar(4000) = N'https://api.powerbi.com/v1.0/myorg/datasets/dfb102e5-5b50-46ee-8d8f-c9b21ea088e5/executeQueries';\n--declare @RelativePath nvarchar(4000) = N'admin/groups?$top=1000&$expand=datasets,dataflows,reports,dashboards,users';\ndeclare @token nvarchar(max) = N'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyIsImtpZCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyJ9.eyJhdWQiOiJodHRwczovL2FuYWx5c2lzLndpbmRvd3MubmV0L3Bvd2VyYmkvYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvZjQ0YzUzZWEtYTRjMy00OTljLWJmMWUtYTE4OTFiNTY1ZTFkLyIsImlhdCI6MTY3ODM0OTQxNiwibmJmIjoxNjc4MzQ5NDE2LCJleHAiOjE2NzgzNTM0MTcsImFjY3QiOjAsImFjciI6IjEiLCJhaW8iOiJBVlFBcS84VEFBQUFFMloxQUttTGxnY3IvTUJ6S3NlSXBQUjJmMWw3QVN1M1ZPUG1GYjhBV3hoUTdpOG5sc2hTZ1FUV1FUSlY0SDIzb2Z1NThaNHJpNE91L1E1ODNXUU5GZVFmTnNFcnFUTUo4ZDJNMGRobEd3RT0iLCJhbXIiOlsicnNhIiwid2lhIiwibWZhIl0sImFwcGlkIjoiMThmYmNhMTYtMjIyNC00NWY2LTg1YjAtZjdiZjJiMzliM2YzIiwiYXBwaWRhY3IiOiIwIiwiZGV2aWNlaWQiOiJhMjlkYWM5Zi1mZjc3LTQzMmQtOTk2Ny03NDdlMjkzOWI4YjkiLCJmYW1pbHlfbmFtZSI6IkVsIE1hZ2hyYWJpIiwiZ2l2ZW5fbmFtZSI6IkFobWVkIiwiaXBhZGRyIjoiMTkzLjI4LjE0Ny4xMiIsIm5hbWUiOiJBaG1lZCBFbCBNYWdocmFiaSIsIm9pZCI6ImQ3NWFmMjFiLTFjNDctNDFiYi1iZDYzLTU4YTkyZTA2YzUzNCIsIm9ucHJlbV9zaWQiOiJTLTEtNS0yMS0xMDg2NzM4ODQyLTExOTA1OTY5MzgtNDk1NTM1MTE5LTMyMTQyOSIsInB1aWQiOiIxMDAzMDAwMEFBQzYwQTZGIiwicmgiOiIwLkFRd0E2bE5NOU1Pa25FbV9IcUdKRzFaZUhRa0FBQUFBQUFBQXdBQUFBQUFBQUFBTUFFWS4iLCJzY3AiOiJBcHAuUmVhZC5BbGwgQ2FwYWNpdHkuUmVhZC5BbGwgQ2FwYWNpdHkuUmVhZFdyaXRlLkFsbCBDb250ZW50LkNyZWF0ZSBEYXNoYm9hcmQuUmVhZC5BbGwgRGFzaGJvYXJkLlJlYWRXcml0ZS5BbGwgRGF0YWZsb3cuUmVhZC5BbGwgRGF0YWZsb3cuUmVhZFdyaXRlLkFsbCBEYXRhc2V0LlJlYWQuQWxsIERhdGFzZXQuUmVhZFdyaXRlLkFsbCBHYXRld2F5LlJlYWQuQWxsIEdhdGV3YXkuUmVhZFdyaXRlLkFsbCBQaXBlbGluZS5EZXBsb3kgUGlwZWxpbmUuUmVhZC5BbGwgUGlwZWxpbmUuUmVhZFdyaXRlLkFsbCBSZXBvcnQuUmVhZC5BbGwgUmVwb3J0LlJlYWRXcml0ZS5BbGwgU3RvcmFnZUFjY291bnQuUmVhZC5BbGwgU3RvcmFnZUFjY291bnQuUmVhZFdyaXRlLkFsbCBUZW5hbnQuUmVhZC5BbGwgVGVuYW50LlJlYWRXcml0ZS5BbGwgVXNlclN0YXRlLlJlYWRXcml0ZS5BbGwgV29ya3NwYWNlLlJlYWQuQWxsIFdvcmtzcGFjZS5SZWFkV3JpdGUuQWxsIiwic2lnbmluX3N0YXRlIjpbImlua25vd25udHdrIiwia21zaSJdLCJzdWIiOiJBUG43WnFYTEEyajBTMUw1ZEZkd1hOdGpDS3ptbDN5U2FWaGIyem5tR0hRIiwidGlkIjoiZjQ0YzUzZWEtYTRjMy00OTljLWJmMWUtYTE4OTFiNTY1ZTFkIiwidW5pcXVlX25hbWUiOiJBSEVMMDIxMUBkc2IuZGsiLCJ1cG4iOiJBSEVMMDIxMUBkc2IuZGsiLCJ1dGkiOiJwcHREcDkxNzYwcWozdUtkN19NbUFBIiwidmVyIjoiMS4wIiwid2lkcyI6WyJiNzlmYmY0ZC0zZWY5LTQ2ODktODE0My03NmIxOTRlODU1MDkiXX0.UHnbgH_QYgTEgmN2wnGRzHpzESyvOKcnJy9vWXnYVOvRkNbQVIL4jbLwIqD8Pu3uAgj88u7-DlNe8oXDCfCsgae1N-qsJ5KS9p-KgJekebvsqaVmxqmIuSlmhV2mjhoFDCnprNfOX3berJyne1ZrmLkEfsnrX9OngKFxYbVfY3Axu56pfgImNiHy1qG7QOfn18FQGi-BYzDrlFYLKI748shE1btmNgkwzEebUjGSdScVChu-x9LVNVFFayvMB20GR-YqegvpDXS5wMHKl62OsRUi7cCNNS0oBh6Kd7TwAkxjwcctmaA1lrSR17MXDgTYIqIVapoxZOMqtEK19nZf9g';\ndeclare @headers nvarchar(4000) = N'{ \"Authorization\": \"Bearer ' + @token + '\"}';\ndeclare @ret int, @response varchar(max);\n--https://app.powerbi.com/groups/11f4471e-fa1f-41d2-9c9d-a50227031c72/datasets/1b81b096-5329-4bad-a2fe-c6f6db7181ef/details\n\ndeclare @pageload nvarchar(max) = N'{\n  \"queries\": [\n    {\n      \"query\": \"' + '\n        \n            EVALUATE TOPN( 500, VALUES(''Datasets''[name]) )\n       \n        '+ '\"\n    }\n  ],\n  \"serializerSettings\": {\n    \"includeNulls\": true\n  }\n}'\n\n--SELECT @pageload\n\n\n \nexec @ret = sys.sp_invoke_external_rest_endpoint\n    --\n    @url = @url,\n    @pageload = @pageload,\n    @method = 'POST',\n    @response = @response output;\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "atlassqldev",
				"poolName": "atlassqldev"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}